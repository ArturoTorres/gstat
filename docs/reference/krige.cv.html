<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>(co)kriging cross validation, n-fold or leave-one-out — krige.cv • gstat</title>

<!-- jquery -->
<script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script>

<!-- sticky kit -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>



<meta property="og:title" content="(co)kriging cross validation, n-fold or leave-one-out — krige.cv" />

<meta property="og:description" content="Cross validation functions for simple, ordinary or universal
point (co)kriging, kriging in a local neighbourhood." />
<meta name="twitter:card" content="summary" />



<!-- mathjax -->
<script src='https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">gstat</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">2.0.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/r-spatial/gstat/">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>(co)kriging cross validation, n-fold or leave-one-out</h1>
    
    <div class="hidden name"><code>krige.cv.Rd</code></div>
    </div>

    <div class="ref-description">
    
    <p>Cross validation functions for simple, ordinary or universal
point (co)kriging, kriging in a local neighbourhood.</p>
    
    </div>

    <pre class="usage"><span class='fu'>gstat.cv</span>(<span class='no'>object</span>, <span class='no'>nfold</span>, <span class='kw'>remove.all</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>verbose</span> <span class='kw'>=</span> <span class='fu'>interactive</span>(),
        <span class='kw'>all.residuals</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='no'>...</span>)
<span class='fu'>krige.cv</span>(<span class='no'>formula</span>, <span class='no'>locations</span>, <span class='no'>...</span>)
<span class='fu'>krige.cv.locations</span>(<span class='no'>formula</span>, <span class='no'>locations</span>, <span class='no'>data</span>, <span class='kw'>model</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='no'>...</span>, <span class='kw'>beta</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
        <span class='kw'>nmax</span> <span class='kw'>=</span> <span class='fl'>Inf</span>, <span class='kw'>nmin</span> <span class='kw'>=</span> <span class='fl'>0</span>, <span class='kw'>maxdist</span> <span class='kw'>=</span> <span class='fl'>Inf</span>, <span class='kw'>nfold</span> <span class='kw'>=</span> <span class='fu'>nrow</span>(<span class='no'>data</span>),
        <span class='kw'>verbose</span> <span class='kw'>=</span> <span class='fu'>interactive</span>(), <span class='kw'>debug.level</span> <span class='kw'>=</span> <span class='fl'>0</span>)
<span class='fu'>krige.cv.spatial</span>(<span class='no'>formula</span>, <span class='no'>locations</span>, <span class='kw'>model</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='no'>...</span>, <span class='kw'>beta</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
        <span class='kw'>nmax</span> <span class='kw'>=</span> <span class='fl'>Inf</span>, <span class='kw'>nmin</span> <span class='kw'>=</span> <span class='fl'>0</span>, <span class='kw'>maxdist</span> <span class='kw'>=</span> <span class='fl'>Inf</span>, <span class='kw'>nfold</span> <span class='kw'>=</span> <span class='fu'>nrow</span>(<span class='no'>locations</span>),
        <span class='kw'>verbose</span> <span class='kw'>=</span> <span class='fu'>interactive</span>(), <span class='kw'>debug.level</span> <span class='kw'>=</span> <span class='fl'>0</span>)</pre>
    
    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>object</th>
      <td><p>object of class gstat; see function <a href='gstat.html'>gstat</a></p></td>
    </tr>
    <tr>
      <th>nfold</th>
      <td><p>integer; if larger than 1, then apply n-fold cross validation; 
  if <code>nfold</code> equals <code>nrow(data)</code> (the default), apply leave-one-out cross 
  validation; if set to e.g. 5, five-fold cross validation is done. To specify the
  folds, pass an integer vector of length <code>nrow(data)</code> with fold indexes.</p></td>
    </tr>
    <tr>
      <th>remove.all</th>
      <td><p>logical; if TRUE, remove observations at cross validation
  locations not only for the first, but for all subsequent variables as well</p></td>
    </tr>
    <tr>
      <th>verbose</th>
      <td><p>logical; if FALSE, progress bar is suppressed</p></td>
    </tr>
    <tr>
      <th>all.residuals</th>
      <td><p>logical; if TRUE, residuals for all variables are
  returned instead of for the first variable only</p></td>
    </tr>
    <tr>
      <th>&#8230;</th>
      <td><p>other arguments that will be passed to <a href='predict.gstat.html'>predict</a>
  in case of <code>gstat.cv</code>, or to <a href='gstat.html'>gstat</a> in case of <code>krige.cv</code></p></td>
    </tr>
    <tr>
      <th>formula</th>
      <td><p>formula that defines the dependent variable as a linear
  model of independent variables; suppose the dependent variable has name
  <code>z</code>, for ordinary and simple kriging use the formula <code>z~1</code>;
  for simple kriging also define <code>beta</code> (see below); for universal
  kriging, suppose <code>z</code> is linearly dependent on <code>x</code> and <code>y</code>,
  use the formula <code>z~x+y</code></p></td>
    </tr>
    <tr>
      <th>locations</th>
      <td><p>data object deriving from class <code>Spatial</code> or <code>sf</code></p></td>
    </tr>
    <tr>
      <th>data</th>
      <td><p>data frame (deprecated); should contain the dependent variable, independent
  variables, and coordinates; only to be provided if <code>locations</code> is a formula</p></td>
    </tr>
    <tr>
      <th>model</th>
      <td><p>variogram model of dependent variable (or its residuals), 
  defined by a call to <a href='vgm.html'>vgm</a> or <a href='fit.variogram.html'>fit.variogram</a></p></td>
    </tr>
    <tr>
      <th>beta</th>
      <td><p>only for simple kriging (and simulation based on simple
  kriging); vector with the trend coefficients (including intercept);
  if no independent variables are defined the model only contains an
  intercept and this should be the simple kriging mean</p></td>
    </tr>
    <tr>
      <th>nmax</th>
      <td><p>for local kriging: the number of nearest observations that
  should be used for a kriging prediction or simulation, where nearest
  is defined in terms of the space of the spatial locations. By default,
  all observations are used</p></td>
    </tr>
    <tr>
      <th>nmin</th>
      <td><p>for local kriging: if the number of nearest observations
  within distance <code>maxdist</code> is less than <code>nmin</code>, a missing 
  value will be generated; see maxdist</p></td>
    </tr>
    <tr>
      <th>maxdist</th>
      <td><p>for local kriging: only observations within a distance
  of <code>maxdist</code> from the prediction location are used for prediction
  or simulation; if combined with <code>nmax</code>, both criteria apply</p></td>
    </tr>
    <tr>
      <th>debug.level</th>
      <td><p>print debugging information; 0 suppresses
  debug information</p></td>
    </tr>
    </table>
    
    <h2 class="hasAnchor" id="methods"><a class="anchor" href="#methods"></a>Methods</h2>

    <dl class='dl-horizontal'>
<dt>formula = "formula", locations = "formula"</dt><dd><p>locations specifies which coordinates in <code>data</code> refer to spatial coordinates</p></dd>
<dt>formula = "formula", locations = "Spatial"</dt><dd><p>Object locations knows about its own spatial locations</p></dd>
</dl>
    
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>Leave-one-out cross validation (LOOCV) visits a data point, and
predicts the value at that location by leaving out the observed value,
and proceeds with the next data point. (The observed value is left
out because kriging would otherwise predict the value itself.) N-fold
cross validation makes a partitions the data set in N parts. For all
observation in a part, predictions are made based on the remaining N-1
parts; this is repeated for each of the N parts. N-fold cross validation
may be faster than LOOCV.</p>
    
    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>data frame containing the coordinates of <code>data</code> or those
of the first variable in <code>object</code>, and columns of prediction and
prediction variance of cross validated data points, observed values,
residuals, zscore (residual divided by kriging standard error), and fold.</p>
<p>If <code>all.residuals</code> is true, a data frame with residuals for all
variables is returned, without coordinates.</p>
    
    <h2 class="hasAnchor" id="references"><a class="anchor" href="#references"></a>References</h2>

    <p><a href='http://www.gstat.org/'>http://www.gstat.org/</a></p>
    
    <h2 class="hasAnchor" id="note"><a class="anchor" href="#note"></a>Note</h2>

    <p>Leave-one-out cross validation seems to be much faster in plain
(stand-alone) gstat, apparently quite a bit of the effort is spent moving 
data around from R to gstat.</p>
    
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><a href='krige.html'>krige</a>, <a href='gstat.html'>gstat</a>, <a href='predict.gstat.html'>predict</a></p></div>
    

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='fu'>library</span>(<span class='no'>sp</span>)
<span class='fu'>data</span>(<span class='no'>meuse</span>)
<span class='fu'><a href='http://www.rdocumentation.org/packages/sp/topics/coordinates'>coordinates</a></span>(<span class='no'>meuse</span>) <span class='kw'>&lt;-</span> ~<span class='no'>x</span>+<span class='no'>y</span>
<span class='no'>m</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='vgm.html'>vgm</a></span>(<span class='fl'>.59</span>, <span class='st'>"Sph"</span>, <span class='fl'>874</span>, <span class='fl'>.04</span>)
<span class='co'># five-fold cross validation:</span>
<span class='no'>x</span> <span class='kw'>&lt;-</span> <span class='fu'>krige.cv</span>(<span class='fu'>log</span>(<span class='no'>zinc</span>)~<span class='fl'>1</span>, <span class='no'>meuse</span>, <span class='no'>m</span>, <span class='kw'>nmax</span> <span class='kw'>=</span> <span class='fl'>40</span>, <span class='kw'>nfold</span><span class='kw'>=</span><span class='fl'>5</span>)
<span class='fu'><a href='http://www.rdocumentation.org/packages/sp/topics/bubble'>bubble</a></span>(<span class='no'>x</span>, <span class='st'>"residual"</span>, <span class='kw'>main</span> <span class='kw'>=</span> <span class='st'>"log(zinc): 5-fold CV residuals"</span>)</div><div class='img'><img src='krige.cv-1.png' alt='' width='700' height='433' /></div><div class='input'>
<span class='co'># multivariable; thanks to M. Rufino:</span>
<span class='no'>meuse.g</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='gstat.html'>gstat</a></span>(<span class='kw'>id</span> <span class='kw'>=</span> <span class='st'>"zn"</span>, <span class='kw'>formula</span> <span class='kw'>=</span> <span class='fu'>log</span>(<span class='no'>zinc</span>) ~ <span class='fl'>1</span>, <span class='kw'>data</span> <span class='kw'>=</span> <span class='no'>meuse</span>)
<span class='no'>meuse.g</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='gstat.html'>gstat</a></span>(<span class='no'>meuse.g</span>, <span class='st'>"cu"</span>, <span class='fu'>log</span>(<span class='no'>copper</span>) ~ <span class='fl'>1</span>, <span class='no'>meuse</span>)
<span class='no'>meuse.g</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='gstat.html'>gstat</a></span>(<span class='no'>meuse.g</span>, <span class='kw'>model</span> <span class='kw'>=</span> <span class='fu'><a href='vgm.html'>vgm</a></span>(<span class='fl'>1</span>, <span class='st'>"Sph"</span>, <span class='fl'>900</span>, <span class='fl'>1</span>), <span class='kw'>fill.all</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>)
<span class='no'>x</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='variogram.html'>variogram</a></span>(<span class='no'>meuse.g</span>, <span class='kw'>cutoff</span> <span class='kw'>=</span> <span class='fl'>1000</span>)
<span class='no'>meuse.fit</span> <span class='kw'>=</span> <span class='fu'><a href='fit.lmc.html'>fit.lmc</a></span>(<span class='no'>x</span>, <span class='no'>meuse.g</span>)
<span class='no'>out</span> <span class='kw'>=</span> <span class='fu'>gstat.cv</span>(<span class='no'>meuse.fit</span>, <span class='kw'>nmax</span> <span class='kw'>=</span> <span class='fl'>40</span>, <span class='kw'>nfold</span> <span class='kw'>=</span> <span class='fl'>5</span>)</div><div class='output co'>#&gt; Linear Model of Coregionalization found. Good.
#&gt; [using ordinary cokriging]
#&gt; Linear Model of Coregionalization found. Good.
#&gt; [using ordinary cokriging]
#&gt; Linear Model of Coregionalization found. Good.
#&gt; [using ordinary cokriging]
#&gt; Linear Model of Coregionalization found. Good.
#&gt; [using ordinary cokriging]
#&gt; Linear Model of Coregionalization found. Good.
#&gt; [using ordinary cokriging]</div><div class='input'><span class='fu'>summary</span>(<span class='no'>out</span>)</div><div class='output co'>#&gt; Object of class SpatialPointsDataFrame
#&gt; Coordinates:
#&gt;      min    max
#&gt; x 178605 181390
#&gt; y 329714 333611
#&gt; Is projected: NA 
#&gt; proj4string : [NA]
#&gt; Number of points: 155
#&gt; Data attributes:
#&gt;     zn.pred          zn.var           observed        residual         
#&gt;  Min.   :4.658   Min.   :0.04090   Min.   :4.727   Min.   :-1.0320765  
#&gt;  1st Qu.:5.319   1st Qu.:0.05084   1st Qu.:5.288   1st Qu.:-0.1479681  
#&gt;  Median :5.819   Median :0.05453   Median :5.787   Median : 0.0208764  
#&gt;  Mean   :5.887   Mean   :0.05592   Mean   :5.886   Mean   :-0.0009484  
#&gt;  3rd Qu.:6.400   3rd Qu.:0.05975   3rd Qu.:6.514   3rd Qu.: 0.1456608  
#&gt;  Max.   :7.715   Max.   :0.09869   Max.   :7.517   Max.   : 0.5331096  
#&gt;      zscore               fold      
#&gt;  Min.   :-4.176047   Min.   :1.000  
#&gt;  1st Qu.:-0.609496   1st Qu.:2.000  
#&gt;  Median : 0.085072   Median :3.000  
#&gt;  Mean   : 0.000348   Mean   :3.148  
#&gt;  3rd Qu.: 0.633631   3rd Qu.:4.500  
#&gt;  Max.   : 2.416199   Max.   :5.000  </div><div class='input'><span class='no'>out</span> <span class='kw'>=</span> <span class='fu'>gstat.cv</span>(<span class='no'>meuse.fit</span>, <span class='kw'>nmax</span> <span class='kw'>=</span> <span class='fl'>40</span>, <span class='kw'>nfold</span> <span class='kw'>=</span> <span class='fu'>c</span>(<span class='fu'>rep</span>(<span class='fl'>1</span>,<span class='fl'>100</span>), <span class='fu'>rep</span>(<span class='fl'>2</span>,<span class='fl'>55</span>)))</div><div class='output co'>#&gt; Linear Model of Coregionalization found. Good.
#&gt; [using ordinary cokriging]
#&gt; Linear Model of Coregionalization found. Good.
#&gt; [using ordinary cokriging]</div><div class='input'><span class='fu'>summary</span>(<span class='no'>out</span>)</div><div class='output co'>#&gt; Object of class SpatialPointsDataFrame
#&gt; Coordinates:
#&gt;      min    max
#&gt; x 178605 181390
#&gt; y 329714 333611
#&gt; Is projected: NA 
#&gt; proj4string : [NA]
#&gt; Number of points: 155
#&gt; Data attributes:
#&gt;     zn.pred          zn.var           observed        residual       
#&gt;  Min.   :4.856   Min.   :0.04393   Min.   :4.727   Min.   :-1.52437  
#&gt;  1st Qu.:5.382   1st Qu.:0.05944   1st Qu.:5.288   1st Qu.:-0.27045  
#&gt;  Median :5.903   Median :0.07107   Median :5.787   Median :-0.09095  
#&gt;  Mean   :5.966   Mean   :0.07283   Mean   :5.886   Mean   :-0.07990  
#&gt;  3rd Qu.:6.428   3rd Qu.:0.08454   3rd Qu.:6.514   3rd Qu.: 0.14914  
#&gt;  Max.   :7.734   Max.   :0.10621   Max.   :7.517   Max.   : 0.55106  
#&gt;      zscore             fold      
#&gt;  Min.   :-4.7612   Min.   :1.000  
#&gt;  1st Qu.:-0.9359   1st Qu.:1.000  
#&gt;  Median :-0.3354   Median :1.000  
#&gt;  Mean   :-0.2678   Mean   :1.355  
#&gt;  3rd Qu.: 0.6001   3rd Qu.:2.000  
#&gt;  Max.   : 2.3860   Max.   :2.000  </div><div class='input'><span class='co'># mean error, ideally 0:</span>
<span class='fu'>mean</span>(<span class='no'>out</span>$<span class='no'>residual</span>)</div><div class='output co'>#&gt; [1] -0.07990434</div><div class='input'><span class='co'># MSPE, ideally small</span>
<span class='fu'>mean</span>(<span class='no'>out</span>$<span class='no'>residual</span>^<span class='fl'>2</span>)</div><div class='output co'>#&gt; [1] 0.1101475</div><div class='input'><span class='co'># Mean square normalized error, ideally close to 1</span>
<span class='fu'>mean</span>(<span class='no'>out</span>$<span class='no'>zscore</span>^<span class='fl'>2</span>)</div><div class='output co'>#&gt; [1] 1.487834</div><div class='input'><span class='co'># correlation observed and predicted, ideally 1</span>
<span class='fu'>cor</span>(<span class='no'>out</span>$<span class='no'>observed</span>, <span class='no'>out</span>$<span class='no'>observed</span> - <span class='no'>out</span>$<span class='no'>residual</span>)</div><div class='output co'>#&gt; [1] 0.8955611</div><div class='input'><span class='co'># correlation predicted and residual, ideally 0</span>
<span class='fu'>cor</span>(<span class='no'>out</span>$<span class='no'>observed</span> - <span class='no'>out</span>$<span class='no'>residual</span>, <span class='no'>out</span>$<span class='no'>residual</span>)</div><div class='output co'>#&gt; [1] -0.1103516</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      
      <li><a href="#methods">Methods</a></li>

      <li><a href="#details">Details</a></li>

      <li><a href="#value">Value</a></li>

      <li><a href="#references">References</a></li>

      <li><a href="#note">Note</a></li>

      <li><a href="#see-also">See also</a></li>
      
      <li><a href="#examples">Examples</a></li>
    </ul>

    <h2>Author</h2>
     Edzer Pebesma 
  </div>
</div>

      <footer>
      <div class="copyright">
  <p>Developed by Edzer Pebesma, Benedikt Graeler.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
   </div>

  

  </body>
</html>

